<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dein persÃ¶nlicher Assistent</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    :root {
      --primary-color: #4f46e5;
      --primary-dark: #4338ca;
      --secondary-color: #f3f4f6;
      --text-color: #1f2937;
      --light-text: #6b7280;
      --background: #f9fafb;
      --card-bg: #ffffff;
      --border-color: #e5e7eb;
      --radius: 12px;
      --transition: all 0.3s ease;
    }

    [data-theme="dark"] {
      --primary-color: #818cf8;
      --primary-dark: #6366f1;
      --secondary-color: #1f2937;
      --text-color: #f3f4f6;
      --light-text: #9ca3af;
      --background: #111827;
      --card-bg: #1f2937;
      --border-color: #374151;
    }

    [data-theme="blue"] {
      --primary-color: #0ea5e9;
      --primary-dark: #0284c7;
      --secondary-color: #e0f2fe;
      --text-color: #0c4a6e;
      --light-text: #60a5fa;
      --background: #f0f9ff;
      --card-bg: #e0f2fe;
      --border-color: #bae6fd;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--background);
      color: var(--text-color);
      margin: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .main-header {
      background-color: var(--card-bg);
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
    }

    .header-actions button,
    .header-actions select {
      margin-left: 0.5rem;
      padding: 0.5rem;
      border-radius: var(--radius);
      border: 1px solid var(--border-color);
      background: var(--secondary-color);
      cursor: pointer;
      transition: var(--transition);
    }

    .header-actions button:hover,
    .header-actions select:hover {
      background-color: var(--primary-color);
      color: white;
    }

    .intro-text {
      background: var(--card-bg);
      margin: 1rem;
      padding: 1rem;
      border-radius: var(--radius);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      font-size: 1rem;
      color: var(--light-text);
    }

    .chat-container {
      flex: 1;
      max-width: 1000px;
      margin: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
    }

    .chat-box {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      padding: 1rem;
      flex: 1;
      overflow-y: auto;
    }

    .message {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1rem;
      align-items: flex-start;
      animation: fadeIn 0.3s ease-in;
    }

    .message.user {
      justify-content: flex-end;
      flex-direction: row-reverse;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary-dark);
      color: white;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .bubble {
      background-color: var(--secondary-color);
      color: var(--text-color);
      padding: 1rem;
      border-radius: var(--radius);
      max-width: 70%;
      white-space: pre-wrap;
      line-height: 1.5;
    }

    .message.user .bubble {
      background-color: var(--primary-color);
      color: white;
    }

    .input-container {
      background-color: var(--card-bg);
      padding: 1rem;
      border-top: 1px solid var(--border-color);
    }

    .input-wrapper {
      display: flex;
      gap: 1rem;
      max-width: 1000px;
      margin: auto;
    }

    textarea {
      flex: 1;
      padding: 1rem;
      font-size: 1rem;
      border-radius: var(--radius);
      border: 1px solid var(--border-color);
      font-family: inherit;
    }

    .send-button {
      background: var(--primary-color);
      border: none;
      color: white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }

    .send-button:hover {
      transform: scale(1.05);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <header class="main-header">
    <h1 id="headline">Willkommen in Deinem Chat zu Personalmanagement</h1>
    <div class="header-actions">
      <button onclick="resetChat()" title="ZurÃ¼cksetzen"><i class="fas fa-redo"></i></button>
      <button onclick="toggleTheme()" title="Theme wechseln"><i class="fas fa-adjust"></i></button>
      <select id="languageSwitcher" onchange="switchLanguage(this.value)" title="Sprache wechseln">
        <option value="de">ðŸ‡©ðŸ‡ª</option>
        <option value="en">ðŸ‡¬ðŸ‡§</option>
        <option value="es">ðŸ‡ªðŸ‡¸</option>
        <option value="tr">ðŸ‡¹ðŸ‡·</option>
      </select>
      <button onclick="printChat()" title="Drucken"><i class="fas fa-print"></i></button>
      <button onclick="exportToPDF()" title="PDF Export"><i class="fas fa-file-pdf"></i></button>
    </div>
  </header>

  <div class="intro-text" id="introText">
    Herzlich willkommen bei Deinem Chatbot. Mit Hilfe von kÃ¼nstlicher Intelligenz unterstÃ¼tze ich Dich bei Fragen rund um das Personalmanagement.
    Stelle Deine Frage so spezifisch wie mÃ¶glich. Ich bin noch im Trainingsmodus, daher weiÃŸ ich noch nicht alles.
    Frage einfach und nutze dazu das Textfeld unten. Beschreibe wer Du bist, z.â€¯B. "Ich bin Teilnehmer des Kurses Handelsfachwirt und habe eine Frage zur Ausbildung, meine Frage lautet konkret: [...]"
  </div>

  <main class="chat-container">
    <div class="chat-box" id="chatBox"></div>
  </main>

  <div class="input-container">
    <div class="input-wrapper">
      <textarea id="userInput" placeholder="Deine Nachricht..." rows="1"></textarea>
      <button class="send-button" id="sendButton"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <script>
    const chatBox = document.getElementById("chatBox");
    const userInput = document.getElementById("userInput");
    const sendButton = document.getElementById("sendButton");

    let userName = localStorage.getItem("userName") || "";

    const languageTexts = {
      de: { headline: "Willkommen in Deinem Chat zu Personalmanagement", intro: "Herzlich willkommen bei Deinem Chatbot..." },
      en: { headline: "Welcome to your HR Chatbot", intro: "Welcome! This chatbot helps with HR topics..." },
      es: { headline: "Bienvenido a tu chatbot de gestiÃ³n de personal", intro: "Â¡Bienvenido! Este chatbot ayuda con temas de RRHH..." },
      tr: { headline: "KiÅŸisel AsistanÄ±na HoÅŸ Geldin", intro: "Merhaba! Bu sohbet botu insan kaynaklarÄ± konularÄ±nda yardÄ±mcÄ± olur..." }
    };

    function switchLanguage(lang) {
      document.getElementById("headline").innerText = languageTexts[lang].headline;
      document.getElementById("introText").innerText = languageTexts[lang].intro;
    }

    function toggleTheme() {
      const html = document.documentElement;
      html.dataset.theme = html.dataset.theme === 'light' ? 'dark' : html.dataset.theme === 'dark' ? 'blue' : 'light';
    }

    function resetChat() {
      chatBox.innerHTML = "";
      userName = "";
      localStorage.removeItem("userName");
      askForName();
    }

    function printChat() {
      window.print();
    }

    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 10;
      chatBox.querySelectorAll(".message").forEach((msg, index) => {
        const sender = msg.classList.contains("user") ? (userName || "Du") : "KI";
        const text = msg.querySelector(".bubble").innerText;
        doc.text(`${sender}: ${text}`, 10, y);
        y += 10;
      });
      doc.setFontSize(10);
      doc.text("Testmodus - bitte sorgfÃ¤ltig prÃ¼fen. Alle Angaben sind unverbindlich.", 10, y + 10);
      doc.save("chat.pdf");
    }

    function addMessage(sender, text) {
      const msg = document.createElement("div");
      msg.className = `message ${sender}`;
      msg.innerHTML = `
        <div class="avatar">${sender === 'user' ? getInitials(userName || 'DU') : 'ðŸ¤–'}</div>
        <div class="bubble">${marked.parse(text)}</div>
      `;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function getInitials(name) {
      return name.split(" ").map(w => w[0]).join("").toUpperCase();
    }

    function askForName() {
      addMessage("bot", "Hallo, wie darf ich Dich ansprechen?");
    }

    function welcomeUser(name) {
      addMessage("bot", `Hallo ${name}, wie kann ich Dir helfen?`);
    }

    function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      addMessage("user", text);
      userInput.value = "";

      if (!userName) {
        userName = text;
        localStorage.setItem("userName", userName);
        setTimeout(() => welcomeUser(userName), 500);
        return;
      }

      addMessage("bot", "ðŸ¤– ...");

      fetch("https://hook.us2.make.com/crk4yctny91n557tnx34f7tjtx9ycudp", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: userName, question: text })
      })
      .then(res => res.text())
      .then(answer => {
        chatBox.lastChild.remove();
        addMessage("bot", answer);
      })
      .catch(err => {
        console.error(err);
        chatBox.lastChild.remove();
        addMessage("bot", "Es gab ein Problem mit der Antwort vom Server.");
      });
    }

    sendButton.onclick = sendMessage;
    userInput.addEventListener("keypress", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    window.onload = () => {
      if (!userName) askForName();
      else welcomeUser(userName);
    };
  </script>
</body>
</html>
