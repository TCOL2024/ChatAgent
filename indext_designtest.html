<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dein persÃ¶nlicher Assistent</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    /* Bisherige Styles (unverÃ¤ndert) */
    /* ... */
  </style>
</head>
<body>
  <header class="main-header">
    <h1 id="headline">Willkommen in Deinem Chat zu Personalmanagement</h1>
    <div class="header-actions">
      <button onclick="resetChat()" title="Chat zurÃ¼cksetzen"><i class="fas fa-redo"></i></button>
      <button onclick="toggleTheme()" title="Darkmode/Bluemode wechseln"><i class="fas fa-adjust"></i></button>
      <button onclick="printChat()" title="Drucken"><i class="fas fa-print"></i></button>
      <button onclick="exportToPDF()" title="PDF Export"><i class="fas fa-file-pdf"></i></button>
      <select id="languageSwitcher" onchange="switchLanguage(this.value)" title="Sprache wechseln">
        <option value="de">ğŸ‡©ğŸ‡ª</option>
        <option value="en">ğŸ‡¬ğŸ‡§</option>
        <option value="es">ğŸ‡ªğŸ‡¸</option>
        <option value="tr">ğŸ‡¹ğŸ‡·</option>
      </select>
    </div>
  </header>

  <div class="intro-text" id="introText">
    Herzlich willkommen bei Deinem Chatbot. Mit Hilfe von kÃ¼nstlicher Intelligenz unterstÃ¼tze ich Dich bei Fragen rund um das Personalmanagement.
    Stelle Deine Frage so spezifisch wie mÃ¶glich. Ich bin noch im Trainingsmodus, daher weiÃŸ ich noch nicht alles.
    Frage einfach und nutze dazu das Textfeld unten. Beschreibe wer Du bist, z.â€¯B. "Ich bin Teilnehmer des Kurses Handelsfachwirt und habe eine Frage zur Ausbildung, meine Frage lautet konkret: [...]"
  </div>

  <main class="chat-container">
    <div class="chat-box" id="chatBox"></div>
    <div class="suggestions" id="suggestions"></div>
  </main>

  <div class="input-container">
    <div class="input-wrapper">
      <textarea id="userInput" placeholder="Deine Nachricht..." rows="1"></textarea>
      <button class="send-button" id="sendButton"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <script>
    const chatBox = document.getElementById("chatBox");
    const userInput = document.getElementById("userInput");
    const sendButton = document.getElementById("sendButton");
    const languageTexts = {
      de: { headline: "Willkommen in Deinem Chat zu Personalmanagement", intro: "Herzlich willkommen bei Deinem Chatbot..." },
      en: { headline: "Welcome to your HR Chatbot", intro: "Welcome! This chatbot helps with HR topics..." },
      es: { headline: "Bienvenido a tu chatbot de gestiÃ³n de personal", intro: "Â¡Bienvenido! Este chatbot ayuda con temas de RRHH..." },
      tr: { headline: "KiÅŸisel AsistanÄ±na HoÅŸ Geldin", intro: "Merhaba! Bu sohbet botu insan kaynaklarÄ± konularÄ±nda yardÄ±mcÄ± olur..." }
    };

    let userName = localStorage.getItem("userName") || "";

    function switchLanguage(lang) {
      document.getElementById("headline").innerText = languageTexts[lang].headline;
      document.getElementById("introText").innerText = languageTexts[lang].intro;
    }

    function toggleTheme() {
      const html = document.documentElement;
      html.dataset.theme = html.dataset.theme === 'light' ? 'dark' : html.dataset.theme === 'dark' ? 'blue' : 'light';
    }

    function printChat() {
      window.print();
    }

    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 10;
      chatBox.querySelectorAll(".message").forEach((msg, index) => {
        const sender = msg.classList.contains("user") ? userName || "Du" : "KI";
        const text = msg.querySelector(".bubble").innerText;
        doc.text(`${sender}: ${text}`, 10, y);
        y += 10;
      });
      doc.setFontSize(10);
      doc.text("Testmodus - bitte sorgfÃ¤ltig prÃ¼fen. Alle Angaben sind unverbindlich.", 10, y + 10);
      doc.save("chat.pdf");
    }

    function addMessage(sender, text) {
      const msg = document.createElement("div");
      msg.className = `message ${sender}`;
      msg.innerHTML = `
        <div class="avatar">${sender === 'user' ? getInitials(userName || 'DU') : 'ğŸ¤–'}</div>
        <div class="bubble">${marked.parse(text)}</div>
      `;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function getInitials(name) {
      return name.split(" ").map(n => n[0]).join("").toUpperCase();
    }

    function resetChat() {
      localStorage.removeItem("userName");
      userName = "";
      chatBox.innerHTML = "";
      askForName();
    }

    function askForName() {
      addMessage("bot", "Hallo! Wie darf ich Dich nennen?");
    }

    function welcomeUser(name) {
      addMessage("bot", `Hallo ${name}, wie kann ich Dir helfen?`);
      showSuggestions();
    }

    function showSuggestions() {
      const suggestions = [
        "Was sind gute FÃ¼hrungsstile?",
        "Wie gelingt Onboarding?",
        "Was ist ein guter Weiterbildungsplan?",
        "Wie spreche ich eine KÃ¼ndigung richtig an?"
      ];
      const container = document.getElementById("suggestions");
      container.innerHTML = "";
      suggestions.forEach(s => {
        const btn = document.createElement("button");
        btn.className = "suggestion-btn";
        btn.innerText = s;
        btn.onclick = () => {
          userInput.value = s;
          sendMessage();
        };
        container.appendChild(btn);
      });
    }

    sendButton.onclick = sendMessage;
    userInput.addEventListener("keypress", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;
      addMessage("user", text);
      userInput.value = "";

      if (!userName) {
        userName = text;
        localStorage.setItem("userName", userName);
        setTimeout(() => welcomeUser(userName), 600);
        return;
      }

      addMessage("bot", "ğŸ¤– ...");

      fetch("https://hook.us2.make.com/crk4yctny91n557tnx34f7tjtx9ycudp", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: userName, question: text })
      })
      .then(res => res.text())
      .then(answer => {
        chatBox.lastChild.remove();
        addMessage("bot", answer);
      })
      .catch(err => {
        console.error(err);
        chatBox.lastChild.remove();
        addMessage("bot", "Es gab ein Problem mit der Antwort vom Server.");
      });
    }

    if (!userName) {
      askForName();
    } else {
      welcomeUser(userName);
    }
  </script>
</body>
</html>
