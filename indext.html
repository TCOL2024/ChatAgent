<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dein pers√∂nlicher Assistent</title>
    <!-- Verhindere favicon 404 -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* (Stile unver√§ndert) */
        /* Modern Variables */
        :root { /* ... */ }
        * { margin:0;padding:0;box-sizing:border-box; }
        body { font-family: 'Inter', sans-serif; background-color: #f9fafb; display:flex;flex-direction:column; min-height:100vh; }
        .main-header { /* ... */ }
        .intro-text { /* ... */ }
        .chat-container { /* ... */ }
        .chat-box { /* ... */ }
        .message-container { /* ... */ }
        .avatar { /* ... */ }
        .message { /* ... */ }
        .input-container { /* ... */ }
        .textarea-wrapper { /* ... */ }
        #userInput { /* ... */ }
        .send-button { /* ... */ }
        .typing-indicator { /* ... */ }
        .dot { /* ... */ }
        @keyframes bounce { /* ... */ }
        @keyframes pulse { /* ... */ }
        /* Media Queries & Print Styles omitted for brevity */
    </style>
</head>
<body>
    <header class="main-header">
        <h1>Willkommen in Deinem Chat zu Personalmanagement</h1>
        <div class="header-actions">
            <button id="print-button" class="btn btn-outline" onclick="window.print()">
                <i class="fas fa-print"></i> Drucken
            </button>
            <button id="reset-button" class="btn btn-danger" onclick="resetChat()">
                <i class="fas fa-redo-alt"></i> Reset
            </button>
        </div>
    </header>
    <div class="intro-text">
        Herzlich willkommen bei Deinem Chatbot. Mit Hilfe von k√ºnstlicher Intelligenz unterst√ºtze ich Dich bei Fragen rund um das Personalmanagement.<br>
        Stelle Deine Frage so spezifisch wie m√∂glich. Ich bin noch im Trainingsmodus, daher wei√ü ich noch nicht alles.
    </div>
    <main class="chat-container">
        <div class="chat-box" id="chatBox"></div>
    </main>
    <div class="input-container">
        <div class="input-wrapper">
            <div class="textarea-wrapper">
                <textarea id="userInput" placeholder="Deine Nachricht..." rows="1"
                    onkeypress="handleKeyPress(event)" oninput="autoResize(this)"></textarea>
            </div>
            <button class="send-button" id="sendButton" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
    <script>
        console.log('üöÄ Chatbot-Skript geladen');
        const webhookUrl = "https://hook.us2.make.com/crk4yctny91n557tnx34f7tjtx9ycudp";
        let isWaitingForResponse = false;
        let chatHistory = [];
        
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }
        
        function renderMessage(sender, text) {
            const chatBox = document.getElementById("chatBox");
            const container = document.createElement("div");
            container.className = `message-container ${sender}`;
            const avatar = document.createElement("div");
            avatar.className = 'avatar';
            avatar.innerHTML = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
            const message = document.createElement("div");
            message.className = sender === 'user' ? 'message user-message' : 'message bot-message';
            message.innerHTML = text;
            container.append(avatar, message);
            chatBox.appendChild(container);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        async function sendMessage() {
            if (isWaitingForResponse) return;
            const textarea = document.getElementById("userInput");
            const text = textarea.value.trim();
            if (!text) return;
            textarea.value = '';
            autoResize(textarea);
            renderMessage('user', text);
            isWaitingForResponse = true;
            document.getElementById('sendButton').disabled = true;

            // Typing indicator
            const typing = document.createElement('div');
            typing.className = 'message-container bot';
            typing.id = 'typing';
            typing.innerHTML = `<div class="avatar"><i class="fas fa-robot"></i></div><div class="typing-indicator"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
            document.getElementById('chatBox').appendChild(typing);
            
            try {
                console.log('Sende an Webhook:', text);
                const res = await fetch(webhookUrl, {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: text })
                });
                console.log('Status:', res.status);
                const payload = await res.text();
                console.log('Antwort (raw):', payload);
                if (!res.ok) throw new Error(`Status ${res.status}`);
                let data;
                try { data = JSON.parse(payload); } catch { data = { answer: payload }; }
                document.getElementById('typing').remove();
                renderMessage('bot', data.answer.replace(/\n/g, '<br>'));
            } catch (e) {
                console.error('Fetch-Fehler:', e);
                document.getElementById('typing').remove();
                renderMessage('bot', 'Entschuldige, beim Senden gab es ein Problem.');
            } finally {
                isWaitingForResponse = false;
                document.getElementById('sendButton').disabled = false;
            }
        }
        
        function handleKeyPress(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }
    </script>
</body>
</html>
